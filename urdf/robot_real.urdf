<?xml version="1.0"?>
<robot name="wheelchair">

  <link name="base_link">
   <!-- <visual>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <box size="0.1 0.1 0.1"/>
      </geometry>
      <material name="gray">
        <color rgba="0.5 0.5 0.5 1"/>
      </material>
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <box size="0.1 0.1 0.1"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="10.0"/> <origin xyz="0 0 0"/>
      <inertia ixx="1.0" ixy="0.0" ixz="0.0" iyy="1.0" iyz="0.0" izz="1.0"/> </inertial>-->
  </link>

  <link name="chair_link">
    <visual>
      <origin xyz="0 0 -0.7" rpy="0 0 -1.5708"/>
      <geometry>
        <mesh filename="file:///home/rania/ign_ws/wheelchair_ign/meshes/Wheelchair_v1.dae" scale="1.5 1.5 1.5"/>
      </geometry>
      <material name="black">
        <color rgba="0 0 0 1"/>
      </material>
    </visual>
    <collision>
      <origin xyz="0 0 -0.7" rpy="0 0 -1.5708"/>
      <geometry>
        <mesh filename="file:///home/rania/ign_ws/wheelchair_ign/meshes/Wheelchair_v1.dae" scale="1.5 1.5 1.5"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="10.0"/>
      <origin xyz="0 0 0"/>
      <inertia ixx="0.1" ixy="0.0" ixz="0.0" iyy="0.1" iyz="0.0" izz="0.1"/>
    </inertial>
  </link>

  <link name="rectangular_box">
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <box size="0.8 0.2 0.02"/>
      </geometry>
      <material name="brown">
        <color rgba="0.65 0.16 0.16 1"/>
      </material>
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <box size="1 0.2 0.02"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="1.0"/>
      <origin xyz="0 0 0"/>
      <inertia ixx="0.01" ixy="0.0" ixz="0.0" iyy="0.01" iyz="0.0" izz="0.01"/>
    </inertial>
  </link>


  <joint name="rectangular_box_joint" type="fixed">
    <parent link="chair_link"/>
    <child link="rectangular_box"/>
    <origin xyz="0 0.6 -0.195" rpy="0 0 0"/>
  </joint>

  <joint name="lidar_joint" type="fixed">
    <parent link="rectangular_box"/>
    <child link="rplidar_link"/>
    <origin xyz="0 0 0.02" rpy="0 0 1.5708"/>
  </joint>

  


  <link name="front_left_wheel">
    <visual>
      <origin xyz="0 0 0" rpy="1.5708 0 1.5708"/>
      <geometry>
        <cylinder radius="0.17" length="0.07"/>
      </geometry>
      <material name="black">
        <color rgba="0.1 0.1 0.1 1"/>
      </material>
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="1.5708 0 1.5708"/>
      <geometry>
        <cylinder radius="0.17" length="0.07"/>
      </geometry>
      <surface>
  <friction>
    <ode>
      <mu>0.8</mu>
      <mu2>0.8</mu2>
    </ode>
  </friction>
  <contact>
    <ode>
      <soft_cfm>0.01</soft_cfm>
      <soft_erp>0.2</soft_erp>
    </ode>
  </contact>
</surface>

    </collision>
    <inertial>
      <mass value="2.5"/>
      <origin xyz="0 0 0"/>
      <inertia ixx="0.03" ixy="0.0" ixz="0.0" iyy="0.06" iyz="0.0" izz="0.03"/>
    </inertial>
  </link>

  <link name="front_right_wheel">
    <visual>
      <origin xyz="0 0 0" rpy="1.5708 0 1.5708"/>
      <geometry>
        <cylinder radius="0.17" length="0.07"/>
      </geometry>
      <material name="black">
        <color rgba="0.1 0.1 0.1 1"/>
      </material>
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="1.5708 0 1.5708"/>
      <geometry>
        <cylinder radius="0.17" length="0.07"/>
      </geometry>
      <surface>
  <friction>
    <ode>
      <mu>0.8</mu>
      <mu2>0.8</mu2>
    </ode>
  </friction>
  <contact>
    <ode>
      <soft_cfm>0.01</soft_cfm>
      <soft_erp>0.2</soft_erp>
    </ode>
  </contact>
</surface>

    </collision>
    <inertial>
      <mass value="2.5"/>
      <origin xyz="0 0 0"/>
      <inertia ixx="0.03" ixy="0.0" ixz="0.0" iyy="0.06" iyz="0.0" izz="0.03"/>
    </inertial>
  </link>

  <link name="left_wheel">
  <visual>
    <origin xyz="0 0 0" rpy="1.5708 0 1.5708"/> <!-- Rotate 90 degrees around X-axis -->
    <geometry>
      <cylinder radius="0.44" length="0.1"/>
    </geometry>
  </visual>
  <collision>
    <origin xyz="0 0 0" rpy="1.5708 0 1.5708"/>
    <geometry>
      <cylinder radius="0.44" length="0.1"/>
    </geometry>
    <surface>
      <friction>
        <ode>
          <mu>1.5</mu>
          <mu2>1.5</mu2>
        </ode>
      </friction>
    </surface>
  </collision>
  <inertial>
    <mass value="5.0"/> <!-- Increased mass -->
    <origin xyz="0 0 0"/>
    <inertia ixx="0.1" ixy="0.0" ixz="0.0" iyy="0.2" iyz="0.0" izz="0.1"/>
  </inertial>
</link>

<link name="right_wheel">
  <visual>
    <origin xyz="0 0 0" rpy="1.5708 0 1.5708"/> <!-- Rotate 90 degrees around X-axis -->
    <geometry>
      <cylinder radius="0.44" length="0.1"/>
    </geometry>
  </visual>
  <collision>
    <origin xyz="0 0 0" rpy="1.5708 0 1.5708"/>
    <geometry>
      <cylinder radius="0.44" length="0.1"/>
    </geometry>
    <surface>
      <friction>
        <ode>
          <mu>1.5</mu>
          <mu2>1.5</mu2>
        </ode>
      </friction>
    </surface>
  </collision>
  <inertial>
    <mass value="5.0"/> <!-- Increased mass -->
    <origin xyz="0 0 0"/>
    <inertia ixx="0.1" ixy="0.0" ixz="0.0" iyy="0.2" iyz="0.0" izz="0.1"/>
  </inertial>
</link>

  <joint name="front_left_wheel_joint" type="fixed">
    <parent link="chair_link"/>
    <child link="front_left_wheel"/>
    <origin xyz="-0.4 0.358 -0.55" rpy="0 0 0"/>
    <dynamics damping="0.1" friction="0.1"/> <!-- Added for passive wheel motion -->
  </joint>

  <joint name="front_right_wheel_joint" type="fixed">
    <parent link="chair_link"/>
    <child link="front_right_wheel"/>
    <origin xyz="0.45 0.358 -0.55" rpy="0 0 0"/>
    <dynamics damping="0.1" friction="0.1"/> <!-- Added for passive wheel motion -->
  </joint>

  <joint name="left_wheel_joint" type="fixed">
    <parent link="chair_link"/>
    <child link="left_wheel"/>
    <origin xyz="-0.45 -0.29 -0.25" rpy="0 0 0"/>
    <axis xyz="1 0 0"/>
    <dynamics damping="0.1" friction="0.1"/> <!-- Added for passive wheel motion -->
  </joint>

  <joint name="right_wheel_joint" type="fixed">
    <parent link="chair_link"/>
    <child link="right_wheel"/>
    <origin xyz="0.4 -0.29 -0.25" rpy="0 0 0"/>
    <axis xyz="1 0 0"/>
    <dynamics damping="0.1" friction="0.1"/> <!-- Added for passive wheel motion -->
  </joint>

  <joint name="chair_link_joint" type="fixed">
    <parent link="base_link"/>
    <child link="chair_link"/>
    <origin xyz="0 0 0.7" rpy="0 0 -1.5708"/>
  </joint>


  <link name="rplidar_link">
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <mesh filename="file:///home/rania/rania_ws/wheelchair/meshes/rplidar_a2.dae" scale="1.5 1.5 1.5"/>
      </geometry>
      <material name="blue">
        <color rgba="0 0 1 1"/>
      </material>
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <mesh filename="file:///home/rania/rania_ws/wheelchair/meshes/rplidar_a2.dae" scale="1.5 1.5 1.5"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="0.5"/>
      <origin xyz="0 0 0"/>
      <inertia ixx="0.01" ixy="0.0" ixz="0.0" iyy="0.01" iyz="0.0" izz="0.01"/>
    </inertial>
  </link>

  

  <!-- Added GPS Link -->
  <link name="gps_link">
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <cylinder radius="0.03" length="0.02"/>  Approximate Garmin GPS18x dimensions 
      </geometry>
      <material name="black">
        <color rgba="0 0 0 1"/>
      </material>
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <cylinder radius="0.03" length="0.02"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="0.1"/>
      <origin xyz="0 0 0"/>
      <inertia ixx="0.0001" ixy="0.0" ixz="0.0" iyy="0.0001" iyz="0.0" izz="0.0001"/>
    </inertial>
  </link>

 
  <joint name="gps_joint" type="fixed">
    <parent link="rectangular_box"/>
    <child link="gps_link"/>
    <origin xyz="0 0 0.03" rpy="0 0 0"/> 
  </joint>

  <!-- IMU Sensor -->
  <link name="imu_link">
    <visual>
      <geometry>
        <cylinder radius="0.015" length="0.04"/>
      </geometry>
      <material name="red"/>
    </visual>
  </link>

  <joint name="imu_joint" type="fixed">
    <parent link="base_link"/>
    <child link="imu_link"/>
    <origin xyz="0.0 0 0.068" rpy="0 0 0"/>
  </joint>


  



  <gazebo reference="base_link">
    <material>Gazebo/Gray</material>
  </gazebo>

  <gazebo reference="chair_link">
    <material>Gazebo/Black</material>
  </gazebo>

  <gazebo reference="left_wheel">
  <mu1>1.5</mu1> <!-- Increase friction coefficient -->
  <mu2>1.5</mu2>
  <kp>1000000.0</kp> <!-- Contact stiffness -->
  <kd>1.0</kd> <!-- Contact damping -->
</gazebo>

<gazebo reference="right_wheel">
  <mu1>1.5</mu1>
  <mu2>1.5</mu2>
  <kp>1000000.0</kp>
  <kd>1.0</kd>
</gazebo>
 
  <gazebo reference="rplidar_link">
        <sensor name="lidar_sensor" type="gpu_lidar">
            <update_rate>10</update_rate>
            <topic>/scan</topic>
            <frame>rplidar_link</frame>
            <lidar>
                <scan>
                    <horizontal>
                        <samples>720</samples>
                        <resolution>1</resolution>
                        <min_angle>-3.14156</min_angle>
                        <max_angle>3.14156</max_angle>
                    </horizontal>
                </scan>
                <range>
                    <min>0.05</min>
                    <max>10.0</max>
                    <resolution>0.01</resolution>
                </range>
                <noise>
                    <type>gaussian</type>
                    <mean>0.0</mean>
                    <stddev>0.01</stddev>
                </noise>
            </lidar>
            <always_on>true</always_on>
            <visualize>true</visualize>
        </sensor>
        </gazebo>
<!--
        <sensor name="rplidar" type="gpu_lidar">
            <pose>0 0 0 0 0 1.57</pose>
            <update_rate>10</update_rate>
            <topic>/scan_in_camera_frame</topic>
            <frame_id>rplidar_link</frame_id>
            <lidar>
                <scan>
                    <horizontal>
                        <samples>720</samples>
                        <resolution>1</resolution>
                        <min_angle>-0.733038286</min_angle>
                        <max_angle>0.733038286</max_angle>
                    </horizontal>
                </scan>
                <range>
                    <min>0.05</min>
                    <max>10.0</max>
                    <resolution>0.01</resolution>
                </range>
                <noise>
                    <type>gaussian</type>
                    <mean>0.0</mean>
                    <stddev>0.01</stddev>
                </noise>
            </lidar>
            <always_on>true</always_on>
            <visualize>true</visualize>
        </sensor>
        
  <sensor type="gpu_lidar" name="rplidar">
    <pose>0 0 0 0 0 1.57</pose>
    <visualize>true</visualize>
    <lidar>
                <scan>
                    <horizontal>
                        <samples>720</samples>
                        <resolution>1</resolution>
                        <min_angle>-0.733038286</min_angle>
                        <max_angle>0.733038286</max_angle>
                    </horizontal>
                </scan>
                <range>
                    <min>0.05</min>
                    <max>10.0</max>
                    <resolution>0.01</resolution>
                </range>
                <noise>
                    <type>gaussian</type>
                    <mean>0.0</mean>
                    <stddev>0.01</stddev>
                </noise>
            </lidar>
            
      <topic>/scan_in_camera_frame</topic>
      <frame_id>rectangular_box</frame_id>
  </sensor> 
 -->


<!--
<gazebo reference="gps_link">
<sensor name="gps_sensor" type="navsat">
          <always_on>true</always_on>
          <update_rate>10</update_rate>
          <topic>/gps/fix</topic>
          <plugin filename="ignition-gazebo-navsat-system" 
                name="ignition::gazebo::systems::NavSat"/>
            <horizontal>
              <noise type="gaussian">
                <mean>0.0</mean>
                <stddev>2.0</stddev>
              </noise>
            </horizontal>
            <vertical>
              <noise type="gaussian">
                <mean>0.0</mean>
                <stddev>3.0</stddev>
              </noise>
            </vertical>
          </plugin>
        </sensor>
</gazebo>

-->
<gazebo reference="gps_link">
<sensor name="navsat" type="navsat">
<pose>0 0 0 0 0 0</pose>
<update_rate>5</update_rate>
<topic>/gps/fix</topic>
<frame>gps_link</frame>
<navsat>
<position_noise>
<type>gaussian</type>
<mean>0.0</mean>
<stddev>2.0</stddev>
</position_noise>
<velocity_noise>
<type>gaussian</type>
<mean>0.0</mean>
<stddev>4.0</stddev>
</velocity_noise>
</navsat>
<always_on>true</always_on>
<visualize>true</visualize>
</sensor>
</gazebo>

<gazebo reference="imu_link">
  <sensor name="imu_sensor" type="imu">
    <always_on>1</always_on>
    <update_rate>1</update_rate>
    <visualize>true</visualize>
    <topic>imu</topic>
</sensor>

  </gazebo>

  <!-- Gazebo Plugins -->
  <gazebo>
  <plugin filename="libignition-gazebo-diff-drive-system.so" name="ignition::gazebo::systems::DiffDrive">
    <left_joint>left_wheel_joint</left_joint>
    <right_joint>right_wheel_joint</right_joint>
    <wheel_separation>0.9</wheel_separation> <!-- Distance between wheels -->
    <wheel_radius>0.44</wheel_radius> <!-- Radius of the wheels -->
    <max_linear_velocity>2.5</max_linear_velocity> <!-- Max forward speed (m/s) -->
    <max_angular_velocity>1.0</max_angular_velocity>
    <topic>/cmd_vel</topic> <!-- Topic to subscribe to for velocity commands -->
    <odom_topic>/odom</odom_topic>
    <odom_frame>odom</odom_frame> 
    <robot_base_frame>base_link</robot_base_frame>
    <publish_odom>true</publish_odom>
    <publish_joint_states>true</publish_joint_states>
    <publish_tf>true</publish_tf>
    <min_velocity>-2.0</min_velocity>
    <max_velocity>2.0</max_velocity>
    <min_acceleration>-10.0</min_acceleration> 
    <max_acceleration>10.0</max_acceleration>
  </plugin>

  <plugin filename="libignition-gazebo-odometry-publisher-system.so" name="ignition::gazebo::systems::OdometryPublisher">
  <odometry_topic>/odom</odometry_topic> 
  <tf_topic>tf</tf_topic>
  <robot_base_frame>base_link</robot_base_frame>

</plugin>
<!-- World control -->
<plugin filename="WorldControl" name="World control">
    <ignition-gui>
        <title>World control</title>
        <property type="bool" key="showTitleBar">false</property>
        <property type="bool" key="resizable">false</property>
        <property type="double" key="height">72</property>
        <property type="double" key="width">121</property>
        <property type="double" key="z">1</property>

        <property type="string" key="state">floating</property>
        <anchors target="3D View">
        <line own="left" target="left"/>
        <line own="bottom" target="bottom"/>
        </anchors>
    </ignition-gui>

    <play_pause>true</play_pause>
    <step>true</step>
    <start_paused>true</start_paused>
    <service>/world/world_demo/control</service>
    <stats_topic>/world/world_demo/stats</stats_topic>
</plugin>

<plugin filename="libignition-gazebo-sensors-system.so" name="ignition::gazebo::systems::Sensors">
  <render_engine>ogre2</render_engine>
</plugin>

<plugin filename="libignition-gazebo-joint-state-publisher-system.so" name="ignition::gazebo::systems::JointStatePublisher">
        </plugin>
        <plugin
        filename="libignition-gazebo-scene-broadcaster-system.so"
        name="gz::sim::systems::SceneBroadcaster">
        </plugin>
        <plugin
        filename="libignition-gazebo-user-commands-system.so"
        name="gz::sim::systems::UserCommands">
        </plugin>
      <plugin filename="libignition-gazebo-velocity-control-system.so"
        name="ignition::gazebo::systems::VelocityControl">
        <topic>cmd_vel</topic>
      </plugin>

      <plugin filename="ignition-gazebo-navsat-system" 
                name="ignition::gazebo::systems::NavSat">
                <topic>/gps/fix</topic>
      </plugin>

      <plugin filename="libignition-gazebo-imu-system.so"
        name="ignition::gazebo::systems::Imu">
</plugin>


</gazebo>




</robot>